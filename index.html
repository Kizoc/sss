<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>è®¢é˜…å·¥å…· - è§£æ+é‡å‘½å+ä¸Šä¼ </title>
<style>
  body { font-family: system-ui, sans-serif; background: #f8f9fa; color: #333; padding: 20px; }
  h2 { text-align: center; color: #4a90e2; }
  textarea { width: 100%; height: 150px; margin: 10px 0; padding: 8px; font-family: monospace; border: 1px solid #ccc; border-radius: 8px; }
  button { padding: 8px 16px; font-size: 15px; border: none; background: #4a90e2; color: white; border-radius: 6px; cursor: pointer; margin:5px; }
  button:hover { background: #357ab8; }
  select, input[type="text"] { padding: 6px; margin:5px; border:1px solid #ccc; border-radius:6px; }
</style>
</head>
<body>
<h2>è®¢é˜…å·¥å…· - è§£æ / é‡å‘½å / ä¸Šä¼ </h2>

<label>è®¢é˜…é“¾æ¥ï¼š</label><br/>
<input type="text" id="subUrl" style="width:90%" placeholder="https://..."><br/>
<button onclick="decodeLocal()">æœ¬åœ°è§£æ</button>
<button onclick="decodeWorker()">Workerè§£æ</button>

<label>è§£æåæ˜æ–‡èŠ‚ç‚¹ï¼š</label>
<textarea id="rawNodes"></textarea>

<button onclick="renameNodes()">é‡å‘½å</button>

<label>é‡å‘½ååèŠ‚ç‚¹ï¼š</label>
<textarea id="renamedNodes"></textarea>

<label>GitHub Tokenï¼š</label><br/>
<input type="text" id="token" style="width:90%" placeholder="ä½ çš„ GitHub Token"><br/>

<label>é€‰æ‹©è¦ä¸Šä¼ çš„ txt æ–‡ä»¶ï¼š</label>
<select id="targetFile">
  <option value="01.txt">01.txt</option>
  <option value="02.txt">02.txt</option>
  <option value="03.txt">03.txt</option>
  <option value="04.txt">04.txt</option>
  <option value="05.txt">05.txt</option>
  <option value="06.txt">06.txt</option>
  <option value="07.txt">07.txt</option>
  <option value="08.txt">08.txt</option>
  <option value="09.txt">09.txt</option>
  <option value="10.txt">10.txt</option>
</select>
<button onclick="uploadToGitHub()">ä¸Šä¼ åˆ°GitHub</button>

<script>
const workerUrl = "https://proxy-worker.kizoc369.workers.dev/";
const userName = "Kizoc";
const repoName = "sss";

async function decodeLocal() {
  try {
    const url = document.getElementById('subUrl').value.trim();
    if (!url) return alert('è¯·è¾“å…¥è®¢é˜…é“¾æ¥');
    const res = await fetch(url);
    const txt = await res.text();
    const decoded = atob(txt.replace(/\s/g,''));
    showDecoded(decoded);
  } catch(e) {
    alert('æœ¬åœ°è§£æå¤±è´¥ï¼š'+e);
  }
}

async function decodeWorker() {
  try {
    const url = document.getElementById('subUrl').value.trim();
    if (!url) return alert('è¯·è¾“å…¥è®¢é˜…é“¾æ¥');
    const res = await fetch(workerUrl+"?url="+encodeURIComponent(url));
    const txt = await res.text();
    const decoded = atob(txt.replace(/\s/g,''));
    showDecoded(decoded);
  } catch(e) {
    alert('é€šè¿‡ Worker è·å–è®¢é˜…å¼‚å¸¸ï¼š'+e);
  }
}

function showDecoded(text) {
  const lines = text.split('\n').filter(l=>!l.startsWith('hy2'));
  document.getElementById('rawNodes').value = lines.join('\n');
}

function renameNodes() {
  const input = document.getElementById('rawNodes').value.trim();
  if (!input) return alert('è¯·å…ˆè§£æè®¢é˜…');
  const lines = input.split('\n');
  const countryKeywords = [
    {key: ['ğŸ‡­ğŸ‡°','é¦™æ¸¯','hongkong','hk'], name:'é¦™æ¸¯'},
    {key: ['ğŸ‡¹ğŸ‡¼','å°æ¹¾','taiwan','tw'], name:'å°æ¹¾'},
    {key: ['ğŸ‡¨ğŸ‡³','ä¸­å›½','china','cn'], name:'ä¸­å›½'},
    {key: ['ğŸ‡¸ğŸ‡¬','æ–°åŠ å¡','singapore','sg'], name:'æ–°åŠ å¡'},
    {key: ['ğŸ‡¯ğŸ‡µ','æ—¥æœ¬','japan','jp'], name:'æ—¥æœ¬'},
    {key: ['ğŸ‡ºğŸ‡¸','ç¾å›½','us','usa','unitedstates'], name:'ç¾å›½'},
    {key: ['ğŸ‡¬ğŸ‡§','è‹±å›½','uk','unitedkingdom'], name:'è‹±å›½'},
    {key: ['ğŸ‡©ğŸ‡ª','å¾·å›½','germany','de'], name:'å¾·å›½'},
    {key: ['ğŸ‡°ğŸ‡·','éŸ©å›½','korea','kr'], name:'éŸ©å›½'},
    {key: ['ğŸ‡«ğŸ‡·','æ³•å›½','france','fr'], name:'æ³•å›½'},
    {key: ['ğŸ‡¦ğŸ‡º','æ¾³å¤§åˆ©äºš','australia','au'], name:'æ¾³å¤§åˆ©äºš'},
    {key: ['ğŸ‡·ğŸ‡º','ä¿„ç½—æ–¯','russia','ru'], name:'ä¿„ç½—æ–¯'},
    {key: ['ğŸ‡¨ğŸ‡¦','åŠ æ‹¿å¤§','canada','ca'], name:'åŠ æ‹¿å¤§'},
    {key: ['ğŸ‡¹ğŸ‡­','æ³°å›½','thailand','th'], name:'æ³°å›½'},
    {key: ['ğŸ‡µğŸ‡­','è²å¾‹å®¾','philippines','ph'], name:'è²å¾‹å®¾'},
    {key: ['ğŸ‡§ğŸ‡·','å·´è¥¿','brazil','br'], name:'å·´è¥¿'},
    {key: ['ğŸ‡®ğŸ‡³','å°åº¦','india','in'], name:'å°åº¦'},
    {key: ['ğŸ‡²ğŸ‡¾','é©¬æ¥è¥¿äºš','malaysia','my'], name:'é©¬æ¥è¥¿äºš'},
  ];
  const renamed=[], unknown=[];
  lines.forEach(line=>{
    let lower=decodeURIComponent(line).toLowerCase();
    let found=false;
    for(let c of countryKeywords){
      if(c.key.some(k=>lower.includes(k))){
        renamed.push(line.replace(/#(.*)?$/,'#æ— æ•Œï½œé«˜é€Ÿï½œ'+c.name));
        found=true; break;
      }
    }
    if(!found) unknown.push(line.replace(/#(.*)?$/,'#æ— æ•Œï½œé«˜é€Ÿï½œæ— æ³•è¯†åˆ«'));
  });
  document.getElementById('renamedNodes').value=renamed.concat(unknown).join('\n');
}

async function uploadToGitHub(){
  const token=document.getElementById('token').value.trim();
  const content=document.getElementById('renamedNodes').value.trim();
  const file=document.getElementById('targetFile').value;
  if(!token) return alert('è¯·å¡«å†™GitHub Token');
  if(!content) return alert('æ²¡æœ‰å†…å®¹å¯ä¸Šä¼ ');
  try{
    let res1=await fetch(`https://api.github.com/repos/${userName}/${repoName}/contents/${file}`);
    let json1=await res1.json();
    let sha=json1.sha;
    let res2=await fetch(`https://api.github.com/repos/${userName}/${repoName}/contents/${file}`,{
      method:"PUT",
      headers:{'Content-Type':'application/json','Authorization':'token '+token},
      body:JSON.stringify({
        message:"update by tool",
        content: btoa(unescape(encodeURIComponent(content))),
        sha
      })
    });
    let json2=await res2.json();
    if(json2.content){
      const link=`https://raw.githubusercontent.com/${userName}/${repoName}/main/${file}`;
      copyToClipboard(link);
      alert('ä¸Šä¼ æˆåŠŸï¼Œé“¾æ¥å·²å¤åˆ¶ï¼š\n'+link);
    }else{
      if(json2.message && json2.message.includes('does not match')){
        res1=await fetch(`https://api.github.com/repos/${userName}/${repoName}/contents/${file}`);
        json1=await res1.json();
        sha=json1.sha;
        res2=await fetch(`https://api.github.com/repos/${userName}/${repoName}/contents/${file}`,{
          method:"PUT",
          headers:{'Content-Type':'application/json','Authorization':'token '+token},
          body:JSON.stringify({
            message:"retry update by tool",
            content: btoa(unescape(encodeURIComponent(content))),
            sha
          })
        });
        json2=await res2.json();
        if(json2.content){
          const link=`https://raw.githubusercontent.com/${userName}/${repoName}/main/${file}`;
          copyToClipboard(link);
          alert('ä¸Šä¼ æˆåŠŸï¼ˆé‡è¯•ï¼‰ï¼Œé“¾æ¥å·²å¤åˆ¶ï¼š\n'+link);
        }else{
          throw json2;
        }
      }else{
        throw json2;
      }
    }
  }catch(e){
    alert('ä¸Šä¼ å¤±è´¥ï¼š'+JSON.stringify(e));
  }
}

function copyToClipboard(text){
  const tmp=document.createElement('textarea');
  tmp.value=text;
  document.body.appendChild(tmp);
  tmp.select();
  document.execCommand('copy');
  document.body.removeChild(tmp);
}
</script>
</body>
</html>

